
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>CAF: Survey</title>

	

	<!-- Bootstrap 4.0.0 Link -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"> -->
	<!-- CSS Link -->
	<!-- <link rel="stylesheet" href="style.css"> -->

</head>

<body>
	
	<div class="row my-5">
		<div class="col-md-6 mx-auto">
			<div id="main-header" class="">
				<div class="card">
					<div class="card-block">
						<h3 class="card-title text-center">Survey</h3>
						<form>
							<h4 class="card-title">About You</h4>
							<div class="form-group">
								<h5 class="survey-question-title" for="name-input">Name</h5>
								<input type="text" class="form-control" id="name-answer" placeholder="First Last">
							</div>

							<div class="form-group">
								<h5 class="survey-question-title" for="photo-input">Photo Image URL</h5>
								<input type="text" class="form-control" id="photo-answer" placeholder="">
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 1</h5>
								<div class="survey-question">Your mind is always buzzing with unexplored ideas and plans.</div>
								<select class="form-control col-2" id="q1Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 2</h5>
								<div class="survey-question">Generally speaking, you rely more on your experience than your imagination.</div>
								<select class="form-control col-2" id="q2Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 3</h5>
								<div class="survey-question">You find it easy to stay relaxed and focused even when there is some pressure.</div>
								<select class="form-control col-2" id="q3Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 4</h5>
								<div class="survey-question">You rarely do something just out of sheer curiosity.</div>
								<select class="form-control col-2" id="q4Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 5</h5>
								<div class="survey-question">People can rarely upset you.</div>
								<select class="form-control col-2" id="q5Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 6</h5>
								<div class="survey-question">It is often difficult for you to relate to other people’s feelings.</div>
								<select class="form-control col-2" id="q6Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 7</h5>
								<div class="survey-question">In a discussion, truth should be more important than people’s sensitivities.</div>
								<select class="form-control col-2" id="q7Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 8</h5>
								<div class="survey-question">You rarely get carried away by fantasies and ideas.</div>
								<select class="form-control col-2" id="q8Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 9</h5>
								<div class="survey-question">You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</div>
								<select class="form-control col-2" id="q9Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>

							<div class="form-group">
								<h5 class="survey-question-title">Question 10</h5>
								<div class="survey-question">You feel more energetic after spending time with a group of people.</div>
								<select class="form-control col-2" id="q10Answer">
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
								</select>
							</div>
							
						<button type="button" id="submit-btn" class="btn btn-primary" data-toggle="modal" data-target="match-modal">Submit</button>
						</form>
						

						<!-- Button trigger modal -->


						<!-- Modal -->
						<div id= "match-modal" class="modal fade">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">Your match!</h5>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<h3 id="match-name" class="modal-title">Insert name</h3>
										<!-- <p>Modal body text goes here.</p> -->
										<img src="http://via.placeholder.com/100x100" id="match-photo"></img>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
				<a href="/api/friends" class="my-5">View API</a>
			</div>







	<!-- Jquery Link -->
	<script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
	crossorigin="anonymous"></script>
	<!-- Popper Link -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
	<!-- Bootstrap 4.0.0 -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
	<!-- Javascript Link -->
	<!-- <script src="javascript.js"></script> -->

	<script type="text/javascript">
		// $('#myModal').on('shown.bs.modal', function () {
		//   $('#myInput').focus()
		// })
		$("#submit-btn").on("click", event => {
			event.preventDefault();
			event.stopPropagation()

			var newFriend = {
				name: $("#name-answer").val().trim(),
				photo: $("#photo-answer").val().trim(),
				scores: [
				$("#q1Answer").val(),
				$("#q2Answer").val(),
				$("#q3Answer").val(),
				$("#q4Answer").val(),
				$("#q5Answer").val(),
				$("#q6Answer").val(),
				$("#q7Answer").val(),
				$("#q8Answer").val(),
				$("#q9Answer").val(),
				$("#q10Answer").val()
				]
			}

			$.get("/api/friends", (friendsArr) => {
				var promise = Promise.resolve();
				promise = promise
				.then( () => determineMatch(newFriend,friendsArr) )
				.then( match => getMatchInfo(match) )
				.then( () => $("#match-modal").modal() )
				.then( () => $.post("/api/friends/new", newFriend) )
			}); 
			
		});

		function determineMatch (newFriend, friendsArr){

			var differences = [];
			var matchIndex = 0;

			for(var i=0; i<friendsArr.length; i++) {
				//create a comparison value
				var total = 0;
				//for each question
				for(var j=0; j<newFriend.scores.length; j++) {
					//compare their score against yours and add the numbers up
					total += updateScoreTotal(newFriend.scores[j],friendsArr[i].scores[j])
				}
				//store the total score difference in an array
				console.log("total:" + total)
				differences.push(total);
				//check if there is a better match
				matchIndex = updateMatchIndex(i,matchIndex,total,differences[matchIndex])
			}
			console.log("differences:")
 			console.log(differences)
			var match = friendsArr[matchIndex];
			console.log("your match is " + match.name)

			return match;
		}

		function updateMatchIndex (i, currentMatchIndex, currentTotal, currentMatchTotal) {
			if(i === 0){
				return 0;
			} else if (currentTotal < currentMatchTotal) { 
				return i;
			}
			return currentMatchIndex;
		}

		function updateScoreTotal (newFriendScore, otherFriendScore) {
			var newFriendInt = parseInt(newFriendScore);
			var otherFriendInt = parseInt(otherFriendScore);
			console.log(newFriendInt, otherFriendInt)
			var diff = Math.abs(newFriendInt - otherFriendInt);
			console.log(diff);

			return diff;
		}

		function getMatchInfo (match) {
			$("#match-name").text(match.name) 
			$("#match-photo").attr("src",match.photo);
		}

	
</script>
</body>
</html>
